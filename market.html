<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IMPROVE AFRICA - Marketplace</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Circular", -apple-system, BlinkMacSystemFont, Roboto,
          Helvetica Neue, sans-serif;
        line-height: 1.43;
        background-color: #fff;
        color: #222;
        -webkit-font-smoothing: antialiased;
      }

      header {
        background-color: #fff;
        border-bottom: 1px solid #ebebeb;
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header-content {
        max-width: 1600px;
        margin: 0 auto;
        padding: 0 80px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        color: #4caf50;
        font-size: 1.5rem;
        font-weight: bold;
        text-decoration: none;
      }

      .category-tabs {
        display: flex;
        overflow-x: auto;
        padding: 20px 80px;
        background: #fff;
        position: sticky;
        top: 70px;
        z-index: 99;
        border-bottom: 1px solid #ebebeb;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
        gap: 12px;
      }

      .category-tabs::-webkit-scrollbar {
        display: none; /* Chrome, Safari and Opera */
      }

      .category-tab {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 30px;
        padding: 10px 20px;
        font-size: 14px;
        color: #333;
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .category-tab.active {
        background-color: #4caf50;
        color: white;
        border-color: #4caf50;
      }

      .category-tab:hover:not(.active) {
        background-color: #f5f5f5;
        border-color: #ccc;
      }

      .category-tab i {
        font-size: 16px;
      }

      .container {
        width: 95%;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 15px;
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        width: 100%;
      }

      .product-card {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        background-color: #fff;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .product-image-wrapper {
        position: relative;
        padding-top: 75%; /* 4:3 aspect ratio */
        overflow: hidden;
      }

      .product-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
      }

      .product-card:hover .product-image {
        transform: scale(1.05);
      }

      .product-badge {
        position: absolute;
        top: 12px;
        left: 12px;
        background-color: #fff;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        z-index: 2;
      }

      .save-button {
        position: absolute;
        top: 12px;
        right: 12px;
        background: none;
        border: none;
        cursor: pointer;
        z-index: 2;
        color: #fff;
        font-size: 24px;
        filter: drop-shadow(0px 0px 2px rgba(0, 0, 0, 0.5));
      }

      .save-button.saved {
        color: #ff385c;
        filter: none;
      }

      .product-details {
        padding-top: 12px;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
      }

      .location-rating {
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        color: #222;
        margin-bottom: 4px;
      }

      .rating {
        display: flex;
        align-items: center;
      }

      .rating i {
        color: #ff385c;
        margin-right: 4px;
        font-size: 12px;
      }

      .product-category {
        font-size: 14px;
        color: #717171;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .product-title {
        font-size: 15px;
        color: #222;
        font-weight: 400;
        margin-bottom: 8px;
      }

      .product-price {
        font-size: 15px;
        font-weight: 500;
        color: #222;
        margin-top: auto;
      }

      .product-price span {
        font-weight: 400;
      }

      .organic-badge {
        display: inline-block;
        background: #4caf50;
        color: white;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 11px;
        margin-left: 4px;
        vertical-align: 1px;
      }

      .quantity-info {
        color: #717171;
        font-size: 14px;
        margin-top: 2px;
      }

      .image-dots {
        position: absolute;
        bottom: 12px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 6px;
      }

      .dot {
        width: 6px;
        height: 6px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 50%;
      }

      .dot.active {
        background: white;
      }

      .products-count {
        margin-bottom: 16px;
        font-size: 16px;
        color: #333;
      }

      .loading {
        text-align: center;
        padding: 40px;
        font-size: 18px;
        color: #666;
      }

      footer {
        background-color: #f7f7f7;
        padding: 24px 80px;
        margin-top: 40px;
        text-align: center;
        border-top: 1px solid #ebebeb;
        font-size: 14px;
        color: #717171;
      }

      @media (max-width: 1120px) {
        .products-grid {
          grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        }
        .header-content,
        .container {
          padding: 0 40px;
        }
        .category-tabs {
          padding: 20px 40px;
        }
      }

      @media (max-width: 743px) {
        .products-grid {
          grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
          gap: 24px 16px;
        }
        .header-content,
        .container {
          padding: 0 24px;
        }
        .category-tabs {
          padding: 20px 24px;
        }
      }

      /* Cart Styles */
      .cart-icon {
        position: relative;
        font-size: 24px;
        color: #4caf50;
        cursor: pointer;
        margin-left: 20px;
      }

      .cart-count {
        position: absolute;
        top: -8px;
        right: -8px;
        background-color: #ff385c;
        color: white;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .cart-panel {
        position: fixed;
        top: 0;
        right: -400px;
        width: 400px;
        height: 100vh;
        background: white;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        transition: right 0.3s ease;
        display: flex;
        flex-direction: column;
      }

      .cart-panel.active {
        right: 0;
      }

      .cart-header {
        padding: 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .close-cart {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
      }

      .cart-items {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
      }

      .cart-item {
        display: flex;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .cart-item-image {
        width: 60px;
        height: 60px;
        border-radius: 8px;
        object-fit: cover;
        margin-right: 15px;
      }

      .cart-item-details {
        flex: 1;
      }

      .cart-item-name {
        font-weight: 500;
        margin-bottom: 5px;
      }

      .cart-item-price {
        color: #666;
        font-size: 14px;
      }

      .cart-item-actions {
        display: flex;
        align-items: center;
        margin-top: 5px;
      }

      .quantity-btn {
        width: 25px;
        height: 25px;
        border: 1px solid #ddd;
        background: white;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      .cart-item-quantity {
        margin: 0 10px;
        font-size: 14px;
      }

      .remove-from-cart {
        color: #ff385c;
        background: none;
        border: none;
        cursor: pointer;
        margin-left: auto;
        font-size: 18px;
      }

      .cart-footer {
        padding: 20px;
        border-top: 1px solid #eee;
      }

      .cart-total {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        font-weight: 500;
      }

      .checkout-btn {
        width: 100%;
        padding: 12px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .checkout-btn:hover {
        background: #3d9940;
      }

      .checkout-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .empty-cart {
        text-align: center;
        padding: 40px 20px;
        color: #666;
      }

      .empty-cart i {
        font-size: 50px;
        color: #ddd;
        margin-bottom: 20px;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }

      .overlay.active {
        display: block;
      }

      /* Order Form Styles */
      .order-form-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1001;
        display: none;
        align-items: center;
        justify-content: center;
      }

      .order-form-container.active {
        display: flex;
      }

      .order-form {
        background: white;
        width: 90%;
        max-width: 500px;
        border-radius: 12px;
        padding: 30px;
        max-height: 90vh;
        overflow-y: auto;
      }

      .order-form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .close-form {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }

      .form-input {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }

      .form-input:focus {
        outline: none;
        border-color: #4caf50;
      }

      .order-summary {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .order-summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
      }

      .order-summary-total {
        display: flex;
        justify-content: space-between;
        font-weight: bold;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #ddd;
      }

      .place-order-btn {
        width: 100%;
        padding: 12px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .place-order-btn:hover {
        background: #3d9940;
      }

      .order-success {
        text-align: center;
        padding: 30px;
      }

      .order-success i {
        font-size: 50px;
        color: #4caf50;
        margin-bottom: 20px;
      }

      .add-to-cart-btn {
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 6px 12px;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.3s;
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .add-to-cart-btn:hover {
        background: #3d9940;
      }

      @media (max-width: 768px) {
        .cart-panel {
          width: 300px;
        }

        .order-form {
          width: 95%;
          padding: 20px;
        }
      }

      /* Navigation Styles */
      .nav-links {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .nav-links li {
        margin: 0 8px;
      }

      .nav-links a {
        color: #333;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: color 0.3s;
      }

      .nav-links a:hover {
        color: #4caf50;
      }

      .nav-links a.active {
        color: #4caf50;
        font-weight: 600;
      }

      @media (max-width: 992px) {
        .nav-links {
          display: none;
        }
      }

      /* Footer Styles */
      .footer-content {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin-bottom: 30px;
      }

      .footer-logo {
        flex-basis: 25%;
        margin-bottom: 20px;
      }

      .footer-logo h2 {
        margin-bottom: 10px;
      }

      .footer-links {
        display: flex;
        flex-basis: 50%;
        flex-wrap: wrap;
        justify-content: space-between;
      }

      .footer-column {
        flex-basis: 30%;
        margin-bottom: 20px;
      }

      .footer-column h3 {
        margin-bottom: 15px;
      }

      .footer-column ul {
        list-style: none;
        padding: 0;
      }

      .footer-column li {
        margin-bottom: 10px;
      }

      .footer-column a {
        text-decoration: none;
      }

      .footer-social {
        flex-basis: 20%;
        margin-bottom: 20px;
      }

      .social-icons {
        display: flex;
        gap: 15px;
      }

      .social-icons a {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.2);
        transition: background-color 0.3s;
      }

      .social-icons a:hover {
        background-color: rgba(255, 255, 255, 0.3);
      }

      .footer-bottom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
      }

      .footer-bottom-links {
        display: flex;
        gap: 20px;
      }

      .footer-bottom-links a {
        text-decoration: none;
      }

      @media (max-width: 992px) {
        .footer-logo,
        .footer-links,
        .footer-social {
          flex-basis: 100%;
        }

        .footer-column {
          flex-basis: 48%;
        }

        .footer-bottom {
          flex-direction: column;
          gap: 10px;
          text-align: center;
        }
      }

      @media (max-width: 576px) {
        .footer-column {
          flex-basis: 100%;
        }

        .footer-bottom-links {
          flex-direction: column;
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-content">
        <a href="/" class="logo">IMPROVE AFRICA</a>
        <div style="display: flex; align-items: center">
          <nav style="margin-right: 20px">
            <ul class="nav-links">
              <li><a href="index1.html">Home</a></li>
              <li><a href="about.html">About Us</a></li>
              <li><a href="programs.html">Programs</a></li>
              <li><a href="regions.html">Regions</a></li>
              <li><a href="jobs.html">Jobs</a></li>
              <li><a href="raw-materials.html">Raw Materials</a></li>
              <li><a href="market.html" class="active">Marketplace</a></li>
              <li><a href="resources.html">Resources</a></li>
              <li><a href="contact.html">Contact</a></li>
            </ul>
          </nav>
          <span id="total-products-header">Premium Agricultural Products</span>
          <div class="cart-icon" id="cart-icon">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="cart-count">0</span>
          </div>
        </div>
      </div>
    </header>

    <div class="category-tabs">
      <button class="category-tab active" data-category="all">
        <i class="fas fa-th"></i> All Products
      </button>
      <button class="category-tab" data-category="Grains">
        <i class="fas fa-wheat-awn"></i> Grains
      </button>
      <button class="category-tab" data-category="Legumes">
        <i class="fas fa-seedling"></i> Legumes
      </button>
      <button class="category-tab" data-category="Oilseeds">
        <i class="fas fa-droplet"></i> Oilseeds
      </button>
      <button class="category-tab" data-category="Roots & Tubers">
        <i class="fas fa-carrot"></i> Roots & Tubers
      </button>
      <button class="category-tab" data-category="Fruits">
        <i class="fas fa-apple-whole"></i> Fruits
      </button>
      <button class="category-tab" data-category="Vegetables">
        <i class="fas fa-leaf"></i> Vegetables
      </button>
      <button class="category-tab" data-category="Spices">
        <i class="fas fa-mortar-pestle"></i> Spices
      </button>
      <button class="category-tab" data-filter="organic">
        <i class="fas fa-seedling"></i> Organic Only
      </button>
    </div>

    <div class="container">
      <div class="products-count">
        <span id="shown-count">0</span> of
        <span id="total-count">0</span> products
      </div>
      <div class="products-grid" id="products-container">
        <div class="loading">Loading products...</div>
      </div>
    </div>

    <!-- Cart Panel -->
    <div class="overlay" id="overlay"></div>
    <div class="cart-panel" id="cart-panel">
      <div class="cart-header">
        <h2>Your Cart</h2>
        <button class="close-cart" id="close-cart">&times;</button>
      </div>
      <div class="cart-items" id="cart-items">
        <div class="empty-cart">
          <i class="fas fa-shopping-basket"></i>
          <p>Your cart is empty</p>
        </div>
      </div>
      <div class="cart-footer">
        <div class="cart-total">
          <span>Total:</span>
          <span id="cart-total-amount">₵0.00</span>
        </div>
        <button class="checkout-btn" id="checkout-btn" disabled>
          Checkout
        </button>
      </div>
    </div>

    <!-- Order Form -->
    <div class="order-form-container" id="order-form-container">
      <div class="order-form">
        <div class="order-form-header">
          <h2>Complete Your Order</h2>
          <button class="close-form" id="close-form">&times;</button>
        </div>
        <div class="order-summary" id="order-summary">
          <h3>Order Summary</h3>
          <div id="order-summary-items"></div>
          <div class="order-summary-total">
            <span>Total:</span>
            <span id="order-total-amount">₵0.00</span>
          </div>
        </div>
        <form id="customer-info-form">
          <div class="form-group">
            <label class="form-label" for="customer-name">Full Name *</label>
            <input type="text" id="customer-name" class="form-input" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="customer-email"
              >Email Address *</label
            >
            <input
              type="email"
              id="customer-email"
              class="form-input"
              required
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="customer-phone"
              >Phone Number *</label
            >
            <input type="tel" id="customer-phone" class="form-input" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="customer-address"
              >Delivery Address *</label
            >
            <textarea
              id="customer-address"
              class="form-input"
              rows="3"
              required
            ></textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="customer-notes"
              >Additional Notes</label
            >
            <textarea
              id="customer-notes"
              class="form-input"
              rows="2"
            ></textarea>
          </div>
          <button type="submit" class="place-order-btn">Place Order</button>
        </form>
        <div class="order-success" id="order-success" style="display: none">
          <i class="fas fa-check-circle"></i>
          <h3>Order Placed Successfully!</h3>
          <p id="order-id"></p>
          <p id="order-confirmation-message"></p>
          <button class="place-order-btn" id="continue-shopping-btn">
            Continue Shopping
          </button>
        </div>
      </div>
    </div>

    <footer
      style="background-color: #2c7744; padding: 40px 0; margin-top: 40px"
    >
      <div class="container">
        <div class="footer-content">
          <div class="footer-logo">
            <h2 style="color: #ffffff">Improve Africa</h2>
            <p style="color: #ffffff">
              Empowering farmers, creating opportunities
            </p>
          </div>
          <div class="footer-links">
            <div class="footer-column">
              <h3 style="color: #ffffff">Quick Links</h3>
              <ul>
                <li><a href="index1.html" style="color: #ffffff">Home</a></li>
                <li>
                  <a href="about.html" style="color: #ffffff">About Us</a>
                </li>
                <li>
                  <a href="programs.html" style="color: #ffffff">Programs</a>
                </li>
                <li>
                  <a href="regions.html" style="color: #ffffff">Regions</a>
                </li>
              </ul>
            </div>
            <div class="footer-column">
              <h3 style="color: #ffffff">Resources</h3>
              <ul>
                <li>
                  <a
                    href="market.html"
                    style="color: #ffffff; font-weight: bold"
                    >Marketplace</a
                  >
                </li>
                <li><a href="jobs.html" style="color: #ffffff">Jobs</a></li>
                <li>
                  <a href="raw-materials.html" style="color: #ffffff"
                    >Raw Materials</a
                  >
                </li>
                <li>
                  <a href="resources.html" style="color: #ffffff"
                    >Farmer Resources</a
                  >
                </li>
                <li><a href="blog.html" style="color: #ffffff">Blog</a></li>
              </ul>
            </div>
            <div class="footer-column">
              <h3 style="color: #ffffff">Contact</h3>
              <ul>
                <li>
                  <a href="contact.html" style="color: #ffffff">Contact Us</a>
                </li>
                <li>
                  <a href="support.html" style="color: #ffffff">Support</a>
                </li>
                <li>
                  <a href="partnerships.html" style="color: #ffffff"
                    >Partnerships</a
                  >
                </li>
                <li><a href="donate.html" style="color: #ffffff">Donate</a></li>
              </ul>
            </div>
          </div>
          <div class="footer-social">
            <h3 style="color: #ffffff">Follow Us</h3>
            <div class="social-icons">
              <a href="#" aria-label="Facebook" style="color: #ffffff"
                ><i class="fab fa-facebook-f"></i
              ></a>
              <a href="#" aria-label="Twitter" style="color: #ffffff"
                ><i class="fab fa-twitter"></i
              ></a>
              <a href="#" aria-label="Instagram" style="color: #ffffff"
                ><i class="fab fa-instagram"></i
              ></a>
              <a href="#" aria-label="LinkedIn" style="color: #ffffff"
                ><i class="fab fa-linkedin-in"></i
              ></a>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <p style="color: #ffffff">
            &copy; 2023 Improve Africa. All rights reserved.
          </p>
          <div class="footer-bottom-links">
            <a href="privacy.html" style="color: #ffffff">Privacy Policy</a>
            <a href="terms.html" style="color: #ffffff">Terms of Service</a>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // All product data
      const allProductsData = [];

      // Function to load all products from API
      async function loadAllProducts() {
        try {
          // Fetch all products from our API endpoint
          const response = await fetch("/api/products");
          if (!response.ok) {
            throw new Error("Failed to fetch products");
          }

          const products = await response.json();

          // Store products in our global array
          allProductsData.push(...products);

          // Update the total count display
          document.getElementById("total-count").textContent =
            allProductsData.length;
          document.getElementById(
            "total-products-header"
          ).textContent = `${allProductsData.length} Premium Agricultural Products`;

          return allProductsData;
        } catch (error) {
          console.error("Error loading products:", error);
          document.getElementById("products-container").innerHTML =
            '<div class="loading">Error loading products. Please try again later.</div>';
          return [];
        }
      }

      // Render products based on filters
      function renderProducts(products) {
        const productsContainer = document.getElementById("products-container");
        productsContainer.innerHTML = "";

        if (products.length === 0) {
          productsContainer.innerHTML =
            '<div class="loading">No products match your filters</div>';
          document.getElementById("shown-count").textContent = 0;
          return;
        }

        document.getElementById("shown-count").textContent = products.length;

        products.forEach((product) => {
          const productCard = document.createElement("div");
          productCard.className = "product-card";

          const imageSrc =
            product.images && product.images.length > 0
              ? product.images[0]
              : "/images/placeholder.jpg";

          // Calculate Ghana Cedis price (10x original price)
          const cedisPrice = product.price * 10;

          productCard.innerHTML = `
            <div class="product-image-wrapper">
              <div class="product-badge">${
                product.subcategory || product.category
              }</div>
              <button class="save-button" aria-label="Save to wishlist">
                <i class="far fa-heart"></i>
              </button>
              <img src="${imageSrc}" alt="${
            product.name
          }" class="product-image">
              <div class="image-dots">
                <span class="dot active"></span>
                ${
                  product.images && product.images.length > 1
                    ? '<span class="dot"></span>'
                    : ""
                }
              ${
                product.images && product.images.length > 2
                  ? '<span class="dot"></span>'
                  : ""
              }
            </div>
                </div>
            <div class="product-details">
              <div class="location-rating">
                <span>${product.origin.region}, ${product.origin.city}</span>
                <span class="rating"><i class="fas fa-star"></i>${
                  product.rating ? product.rating.toFixed(1) : "4.5"
                }</span>
              </div>
              <div class="product-category">${product.category} · ${
            product.subcategory || "General"
          }</div>
              <h3 class="product-title">${product.name}</h3>
              <p class="product-price">₵${cedisPrice.toFixed(2)} <span>/ ${
            product.unit || "kg"
          }</span>
                ${
                  product.isOrganic
                    ? '<span class="organic-badge">Organic</span>'
                    : ""
                }
              </p>
              <p class="quantity-info">Available: ${product.quantity} ${
            product.unit || "kg"
          }</p>
              <button class="add-to-cart-btn" data-product-id="${product.name}">
                <i class="fas fa-cart-plus"></i> Add to Cart
              </button>
          </div>
        `;

          productsContainer.appendChild(productCard);
        });

        // Add click handlers for save buttons
        document.querySelectorAll(".save-button").forEach((btn) => {
          btn.addEventListener("click", function (e) {
            e.preventDefault();
            const icon = this.querySelector("i");
            icon.classList.toggle("far");
            icon.classList.toggle("fas");
            this.classList.toggle("saved");
          });
        });

        // Add click handlers for add to cart buttons
        document.querySelectorAll(".add-to-cart-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const productName = this.getAttribute("data-product-id");
            addToCart(productName);
          });
        });
      }

      // Cart functionality
      let cart = [];

      // Add product to cart
      function addToCart(productName) {
        const product = allProductsData.find((p) => p.name === productName);

        if (!product) {
          console.error(`Product not found: ${productName}`);
          return;
        }

        // Check if product is already in cart
        const existingItem = cart.find(
          (item) => item.product.name === productName
        );

        if (existingItem) {
          // If product is in cart, increase quantity
          if (existingItem.quantity < product.quantity) {
            existingItem.quantity += 1;
            alert(`Added another ${product.name} to your cart!`);
          } else {
            alert(
              `Sorry, only ${product.quantity} units of ${product.name} available.`
            );
            return;
          }
        } else {
          // If product is not in cart, add it
          cart.push({
            product: product,
            quantity: 1,
          });
          alert(`${product.name} added to your cart!`);
        }

        // Update cart UI
        updateCartUI();
      }

      // Remove product from cart
      function removeFromCart(productName) {
        cart = cart.filter((item) => item.product.name !== productName);
        updateCartUI();
      }

      // Update product quantity in cart
      function updateCartItemQuantity(productName, change) {
        const item = cart.find((item) => item.product.name === productName);

        if (!item) return;

        const newQuantity = item.quantity + change;

        if (newQuantity <= 0) {
          removeFromCart(productName);
          return;
        }

        if (newQuantity > item.product.quantity) {
          alert(
            `Sorry, only ${item.product.quantity} units of ${item.product.name} available.`
          );
          return;
        }

        item.quantity = newQuantity;
        updateCartUI();
      }

      // Calculate total price of cart
      function calculateCartTotal() {
        return cart.reduce((total, item) => {
          return total + item.product.price * item.quantity;
        }, 0);
      }

      // Update cart UI
      function updateCartUI() {
        const cartItemsContainer = document.getElementById("cart-items");
        const cartCountElement = document.getElementById("cart-count");
        const cartTotalElement = document.getElementById("cart-total-amount");
        const checkoutButton = document.getElementById("checkout-btn");

        // Update cart count
        const totalItems = cart.reduce(
          (total, item) => total + item.quantity,
          0
        );
        cartCountElement.textContent = totalItems;

        // Update cart items
        if (cart.length === 0) {
          cartItemsContainer.innerHTML = `
            <div class="empty-cart">
              <i class="fas fa-shopping-basket"></i>
              <p>Your cart is empty</p>
            </div>
          `;
          checkoutButton.disabled = true;
        } else {
          cartItemsContainer.innerHTML = cart
            .map((item) => {
              // Calculate Ghana Cedis price (10x original price)
              const cedisPrice = item.product.price * 10;

              return `
            <div class="cart-item">
              <img src="${
                item.product.images && item.product.images.length > 0
                  ? item.product.images[0]
                  : "/images/placeholder.jpg"
              }" 
                   alt="${item.product.name}" 
                   class="cart-item-image">
              <div class="cart-item-details">
                <div class="cart-item-name">${item.product.name}</div>
                <div class="cart-item-price">₵${cedisPrice.toFixed(2)} / ${
                item.product.unit || "kg"
              }</div>
                <div class="cart-item-actions">
                  <button class="quantity-btn decrease-quantity" data-product="${
                    item.product.name
                  }">-</button>
                  <span class="cart-item-quantity">${item.quantity}</span>
                  <button class="quantity-btn increase-quantity" data-product="${
                    item.product.name
                  }">+</button>
                </div>
              </div>
              <button class="remove-from-cart" data-product="${
                item.product.name
              }">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          `;
            })
            .join("");

          // Add event listeners for cart actions
          document.querySelectorAll(".decrease-quantity").forEach((btn) => {
            btn.addEventListener("click", function () {
              const productName = this.getAttribute("data-product");
              updateCartItemQuantity(productName, -1);
            });
          });

          document.querySelectorAll(".increase-quantity").forEach((btn) => {
            btn.addEventListener("click", function () {
              const productName = this.getAttribute("data-product");
              updateCartItemQuantity(productName, 1);
            });
          });

          document.querySelectorAll(".remove-from-cart").forEach((btn) => {
            btn.addEventListener("click", function () {
              const productName = this.getAttribute("data-product");
              removeFromCart(productName);
            });
          });

          checkoutButton.disabled = false;
        }

        // Update cart total with converted prices
        const total = calculateCartTotal() * 10;
        cartTotalElement.textContent = `₵${total.toFixed(2)}`;
      }

      // Update order summary
      function updateOrderSummary() {
        const orderSummaryItemsContainer = document.getElementById(
          "order-summary-items"
        );
        const orderTotalElement = document.getElementById("order-total-amount");

        orderSummaryItemsContainer.innerHTML = cart
          .map((item) => {
            // Calculate Ghana Cedis price (10x original price)
            const cedisPrice = item.product.price * 10;

            return `
          <div class="order-summary-item">
            <span>${item.quantity} x ${item.product.name}</span>
            <span>₵${(cedisPrice * item.quantity).toFixed(2)}</span>
          </div>
        `;
          })
          .join("");

        // Update order total with converted prices
        const total = calculateCartTotal() * 10;
        orderTotalElement.textContent = `₵${total.toFixed(2)}`;
      }

      // Place order
      async function placeOrder(customerInfo) {
        try {
          const orderItems = cart.map((item) => ({
            productName: item.product.name,
            quantity: item.quantity,
          }));

          // Calculate total in Ghana Cedis
          const totalInCedis = calculateCartTotal() * 10;

          const orderData = {
            customerInfo,
            items: orderItems,
            notificationEmail: "improveafrica01@gmail.com",
            totalInCedis: totalInCedis, // Add the converted total
          };

          console.log("Sending order data:", JSON.stringify(orderData));

          const response = await fetch("/api/order", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(orderData),
          });

          if (!response.ok) {
            throw new Error(
              `Server returned ${response.status}: ${response.statusText}`
            );
          }

          const data = await response.json();

          if (data.success) {
            // Show order success message
            document.getElementById("customer-info-form").style.display =
              "none";
            document.getElementById("order-summary").style.display = "none";

            const orderSuccessElement =
              document.getElementById("order-success");
            orderSuccessElement.style.display = "block";

            document.getElementById(
              "order-id"
            ).textContent = `Order ID: ${data.orderId}`;
            document.getElementById(
              "order-confirmation-message"
            ).textContent = `Thank you for your order! Your total is ₵${totalInCedis.toFixed(
              2
            )}. A confirmation has been sent to ${customerInfo.email} and ${
              orderData.notificationEmail
            }.`;

            // Clear cart
            cart = [];
            updateCartUI();
          } else {
            alert(`Error: ${data.error || "Unknown error occurred"}`);
          }
        } catch (error) {
          console.error("Error placing order:", error);
          alert(
            "An error occurred while placing your order. Please try again."
          );
        }
      }

      // Filter products based on selected category
      function filterProducts(category = "all", filterType = "") {
        let filteredProducts = [...allProductsData];

        if (category !== "all") {
          filteredProducts = filteredProducts.filter(
            (product) => product.category === category
          );
        }

        if (filterType === "organic") {
          filteredProducts = filteredProducts.filter(
            (product) => product.isOrganic
          );
        }

        renderProducts(filteredProducts);
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", async () => {
        // Load all products data
        await loadAllProducts();

        // Render all products initially
        renderProducts(allProductsData);

        // Add click handlers for category tabs
        document.querySelectorAll(".category-tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            document
              .querySelectorAll(".category-tab")
              .forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");

            const category = tab.dataset.category;
            const filterType = tab.dataset.filter;

            filterProducts(category, filterType);
          });
        });

        // Cart toggle
        const cartIcon = document.getElementById("cart-icon");
        const cartPanel = document.getElementById("cart-panel");
        const closeCart = document.getElementById("close-cart");
        const overlay = document.getElementById("overlay");

        cartIcon.addEventListener("click", () => {
          cartPanel.classList.add("active");
          overlay.classList.add("active");
        });

        closeCart.addEventListener("click", () => {
          cartPanel.classList.remove("active");
          overlay.classList.remove("active");
        });

        overlay.addEventListener("click", () => {
          cartPanel.classList.remove("active");
          overlay.classList.remove("active");
          document
            .getElementById("order-form-container")
            .classList.remove("active");
        });

        // Checkout button
        const checkoutBtn = document.getElementById("checkout-btn");
        const orderFormContainer = document.getElementById(
          "order-form-container"
        );
        const closeForm = document.getElementById("close-form");

        checkoutBtn.addEventListener("click", () => {
          updateOrderSummary();
          orderFormContainer.classList.add("active");
          cartPanel.classList.remove("active");

          // Reset form
          document.getElementById("customer-info-form").reset();
          document.getElementById("customer-info-form").style.display = "block";
          document.getElementById("order-summary").style.display = "block";
          document.getElementById("order-success").style.display = "none";
        });

        closeForm.addEventListener("click", () => {
          orderFormContainer.classList.remove("active");
        });

        // Continue shopping button
        document
          .getElementById("continue-shopping-btn")
          .addEventListener("click", () => {
            orderFormContainer.classList.remove("active");
            overlay.classList.remove("active");
          });

        // Form submission
        document
          .getElementById("customer-info-form")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            const customerInfo = {
              name: document.getElementById("customer-name").value,
              email: document.getElementById("customer-email").value,
              phone: document.getElementById("customer-phone").value,
              address: document.getElementById("customer-address").value,
              notes: document.getElementById("customer-notes").value,
            };

            placeOrder(customerInfo);
          });

        // Initialize cart UI
        updateCartUI();
      });
    </script>
  </body>
</html>
